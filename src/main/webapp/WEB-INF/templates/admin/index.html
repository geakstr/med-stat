<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:include="layout/header :: head (title='Панель администратора')"></head>
<body>
<style>
#admin-doctor-registration-form {
    width: 300px;
}
</style>

<h1>Панель администратора</h1>

<hr/>

<form th:action="@{/admin/doctors}" th:object="${AdminDoctorRegistrationForm}" id="admin-doctor-registration-form" method="post" autocomplete="off">
    <div class="form-group">
        <label for="admin-doctor-registration-form-email">Электронная почта нового врача</label>
        <input type="email" th:field="*{email}" class="form-control" id="admin-doctor-registration-form-email" autocomplete="off" placeholder="example@mail.ru"/>
    </div>

    <span id="admin-doctor-registration-form-message" class="help-block" style="display: none;">
        <p class="text-danger" style="white-space: pre-wrap;"></p>
    </span>

    <input type="submit"
           id="admin-doctor-registration-form-submit"
           class="btn btn-success"
           data-loading-text="Письмо отправляется…"
           disabled="disabled"
           value="Зарегистрировать"/>
</form>

<form th:action="@{/admin/requests}" th:object="${AdminSetDoctorToPacientForm}" method="post" autocomplete="off">
	<div class="form-group">
		<label for="admin-set-doctor-to-pacient-form-pacient">Выберите пациента:</label>
		<select id="admin-set-doctor-to-pacient-form-pacient" name="selectPacient" th:field="*{pacient}">
			<option th:each="p:${usersList}" th:value="${p.id}" th:text="${p.lastName}"/>
		</select>
	</div>
	<div class="form-group">
		<label for="admin-set-doctor-to-pacient-form-doctor">Выберите доктора:</label>
		<select id="admin-set-doctor-to-pacient-form-doctor" name="selectDoctor" th:field="*{doctor}">
			<option th:each="d:${doctorsList}" th:value="${d.id}" th:text="${d.lastName}"/>
		</select> 
	</div>
	
	<input type="submit"
		   id="admin-set-doctor-to-pacient-form-submit"
		   class="btn btn-success"
		   value="Утвердить"/>
</form>

<span th:include="layout/footer :: scripts" class="hidden"></span>

<script th:inline="javascript">
/*<![CDATA[*/
$(document).ready(function() {
  var $adminDoctorRegistrationForm = $('#admin-doctor-registration-form');
  var $adminDoctorRegistrationFormEmail = $('#admin-doctor-registration-form-email');
  var $adminDoctorRegistrationFormSubmit = $('#admin-doctor-registration-form-submit');
  var $adminDoctorRegistrationFormMessage = $('#admin-doctor-registration-form-message');

  validateAdminDoctorRegistrationForm();

  $adminDoctorRegistrationForm.find('input').on('input change', function(event) {
    validateAdminDoctorRegistrationForm();

    $adminDoctorRegistrationFormMessage.find('p').text('');
    $adminDoctorRegistrationFormMessage.hide();
  });

  $adminDoctorRegistrationForm.submit(function(event) {
    event.preventDefault();

    $adminDoctorRegistrationFormSubmit.button('loading');

    submitForm($(this), 10000, function(response) {
      if (response.type === "error") {
        $adminDoctorRegistrationFormMessage.show();
        $adminDoctorRegistrationFormMessage.find('p').text(response.message);
      } else {
        $adminDoctorRegistrationFormMessage.hide();

        $adminDoctorRegistrationForm.trigger('reset');
      }

      $adminDoctorRegistrationFormSubmit.button('reset');
      $adminDoctorRegistrationFormSubmit.attr('disabled', true);
    }, function(request, status, error) {
      $adminDoctorRegistrationFormMessage.show();
      $adminDoctorRegistrationFormMessage.find('p').text('Что-то пошло не так! Пожалуйста, попробуйте еще через некоторое время');

      $adminDoctorRegistrationFormSubmit.button('reset');
    });

    return false;
  });

  function validateAdminDoctorRegistrationForm() {
      var email = $adminDoctorRegistrationFormEmail.val().trim();

      var disabled = true;
      if (isValidEmail(email)) {
        disabled = false;
      } else {
        disabled = true
      }

      $adminDoctorRegistrationFormSubmit.attr('disabled', disabled);
    }
});
/*]]>*/
</script>

</body>
</html>